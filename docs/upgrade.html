<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Lychee Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

    <link rel="canonical" href="https://lycheeorg.dev/docs/" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/logo.png" />
    <meta name="msapplication-TileColor" content="#ff2d20" />
    <meta name="theme-color" content="#ffffff" />

    <!-- Load styles -->
    <link rel="stylesheet" type="text/css" href="css/app.css" />
    <link rel="stylesheet" type="text/css" href="css/prism.css" />

    <!-- Load JS -->
    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/prism.js"></script>
  </head>

  <body>
    <div class="sidebar_layout" id="docsScreen">
      <div class="page_contain">
        <div class="contain">
          <aside class="sidebar">
            <a href="../" class="logo">
              <img class="mark" src="img/logo.png" alt="Laravel" />
              <img class="type" src="img/Lychee.png" alt="Laravel" />
            </a>
            <nav>
              <div class="navigation_contain">
                <div class="docs_sidebar">
                  <ul>
                    <li class='sub--on'>
<h2>Prologue</h2>
<ul>
<li><a href='releases.html'>Release Notes</a></li>
</ul>
<li class='sub--on'>
<h2>Getting Started</h2>
<ul>
<li><a href='installation.html'>Installation</a></li>
<li><a href='configuration.html'>Configuration</a></li>
<li><a href='docker.html'>Docker</a></li>
<li><a href='update.html'>Update</a></li>
<li class='active'><a href='upgrade.html'>Upgrade from v3</a></li>
</ul>
<li class='sub--on'>
<h2>Advanced Topics</h2>
<ul>
<li><a href='settings.html'>Settings</a></li>
<li><a href='keyboard.html'>Keyboard Shortcuts</a></li>
<li><a href='advanced-setups.html'>Advanced Setups</a></li>
<li><a href='honeypot.html'>Honeypot and Teapots</a></li>
<li><a href='external_tracking.html'>External tracking with Matomo,<br>Google Analytics & Co</a></li>
</ul>
<li class='sub--on'>
<h2>Frequently Asked Question</h2>
<ul>
<li><a href='faq_general.html'>General</a></li>
<li><a href='faq_installation.html'>Installation, migration, upgrade, update</a></li>
<li><a href='faq_troubleshooting.html'>Troubleshooting</a></li>
</ul>
<li class='sub--on'>
<h2>Contributing</h2>
<ul>
<li><a href='contributions.html'>Contribution Guide</a></li>
<li><a href='api.html'>API Documentation</a></li>
<li><a href='architecture.html'>Lychee logic overview</a></li>
<li><a href='structure.html'>Directory Structure</a></li>
<li><a href='frontend.html'>Front-end</a></li>
</ul>

                    <li class="laravel">
                      <a href="https://laravel.com/docs/8.x"
                        ><h2>Laravel<img style="margin-left: 4px" src="img/external-link.svg" /></h2
                      ></a>
                    </li>
                  </ul>
                </div>
              </div>
            </nav>
            <div class="trigger_contain">
              <a href="#" class="nav_trigger" aria-label="Menu">
                <div class="bar"></div>
              </a>
            </div>
          </aside>

          <section class="body_content">
            <section class="docs_body">
              <section class="docs_main">
                <h1>Upgrade from v3</h1>
                
<ul>
<li><a href="#checking-requirements">Checking requirements</a></li>
<li><a href="#preparing-the-files">Preparing the files</a></li>
<li><a href="#preparing-the-server">Preparing the server</a><ul>
<li><a href="#using-apache">Using Apache</a></li>
<li><a href="#using-nginx">Using Nginx</a></li>
<li><a href="#run-the-migrations">Run the migrations</a></li>
</ul>
</li>
</ul>

                <hr />
                <h2 id="checking-requirements"><a class="toclink" href="#checking-requirements">Checking requirements</a></h2>
<p>Check that the server satisfifes the <a href="installation.html#web-server-configuration">requirements</a>. In particular pay attention the PHP extensions.
You can display installed PHP extensions using <code>phpinfo()</code>.</p>
<h2 id="preparing-the-files"><a class="toclink" href="#preparing-the-files">Preparing the files</a></h2>
<p>Assuming the following tree:</p>
<pre><code>/var/
  |- www/
         |- html/
              |- Lychee/
              |- &lt;you are here&gt;
</code></pre>
<p>Rename Lychee into Lychee-v3:</p>
<pre><code class="language-bash">mv Lychee Lychee-v3
</code></pre>
<p>Install Lychee files by either uploading the content of the released zip or cloning the repository:</p>
<pre><code class="language-bash">git clone https://github.com/LycheeOrg/Lychee Lychee
</code></pre>
<p>Move the pictures from the version 3 to the newly created installation:</p>
<pre><code class="language-bash">mv Lychee-v3/uploads/big/* Lychee/public/uploads/big/
mv Lychee-v3/uploads/medium/* Lychee/public/uploads/medium/
mv Lychee-v3/uploads/small/* Lychee/public/uploads/small/
mv Lychee-v3/uploads/thumb/* Lychee/public/uploads/thumb/
</code></pre>
<h2 id="preparing-the-server"><a class="toclink" href="#preparing-the-server">Preparing the server</a></h2>
<blockquote>
<p>{note} The big difference between Lychee version 3 and Lychee version 4 is the served directory, i.e. where you webserver needs to point to.</p>
</blockquote>
<ul>
<li>In the version 3, this was the root <code>.</code> of Lychee.</li>
<li>In the version 4, this is the <code>public</code> directory inside Lychee.</li>
</ul>
<h3 id="using-apache"><a class="toclink" href="#using-apache">Using Apache</a></h3>
<p><strong>Make sure you have the module rewrite available and enabled: <code>a2enmod rewrite</code></strong>.</p>
<p>Modify your <code>/etc/apache2/apache2.conf</code> to allow <code>.htaccess</code> to set up the rewrite rules:</p>
<pre><code class="language-apacheconf">&lt;Directory /var/www/html/Lychee&gt;
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
&lt;/Directory&gt;
</code></pre>
<p>Modify or create <code>example.com.conf</code> in <code>/etc/apache2/sites-available/</code> to point out the served directory:</p>
<pre><code class="language-apacheconf">&lt;VirtualHost *:80&gt;
    ServerName example.com

    DocumentRoot /var/www/html/Lychee/public

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;
</code></pre>
<p>Enable the site:</p>
<pre><code class="language-bash">a2ensite `example.com.conf`
</code></pre>
<p>Restart apache2:</p>
<pre><code class="language-bash">systemctl restart apache2
</code></pre>
<p>Process with the </p>
<h3 id="using-nginx"><a class="toclink" href="#using-nginx">Using Nginx</a></h3>
<p>If you are using Nginx, an example configuration can be found <a href="installation.html#web-server-configuration">here</a>.</p>
<h3 id="run-the-migrations"><a class="toclink" href="#run-the-migrations">Run the migrations</a></h3>
<p>Make sure you have <code>DB_OLD_LYCHEE_PREFIX</code> set in your <code>.env</code> to correspond the table prefix of your old database, then run <code>php artisan migrate</code>. </p><blockquote><p>{tip} Caught a mistake or want to contribute to the documentation?&nbsp;<a href="https://github.com/LycheeOrg/LycheeOrg.github.io/tree/master/docs/upgrade.md">Edit this page on Github!</a></p></blockquote>
              </section>
            </section>
          </section>
        </div>
      </div>
    </div>
  </body>
  <script src="js/app.js"></script>
</html>
